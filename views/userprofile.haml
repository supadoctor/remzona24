.uk-container.uk-container-center
  %br
  / %h1#fullname.uk-text-left #{@current_user.fullname}
  .uk-grid
    .uk-width-2-3
      .uk-panel.uk-panel-box
        %h1.uk-text-right Личный кабинет
        %ul.uk-tab.uk-margin-bottom{"data-uk-tab"=>"{connect:'#operation'}"}
          / %ul.uk-navbar{"data-uk-tab"=>"{connect:'#operation'}"}
          / %div.uk-margin{"data-uk-switcher"=>"{connect:'#operation'}"}
          %li.uk-active
            %a{:href=>"#"} Профиль
          %li
            %a{:href=>"#"}
              Заявки
              .uk-badge.uk-badge-notification.uk-badge-danger
                #{@newoffers.first}
        %ul#operation.uk-switcher
          %li
            %form.uk-form.uk-form-horizontal{:action => "/updateprofile", :method => "post", :enctype=>"multipart/form-data"}
              .uk-form-row.uk-margin
                %h3.uk-form-label{:for=>"avatar"} Фотография
                -if @current_user.avatar.present?
                  .uk-form-controls
                    %img{:src => @current_user.avatar.avatar64.url}
                    %input#avatarfrm{:type=>"file", :name=>"avatar", :hidden=>"true"}
                -else
                  .uk-form-controls{:style=>"margin-top: 5px;"}
                    %span#avatarlbl Нет
                    %input#avatarfrm{:type=>"file", :name=>"avatar", :hidden=>"true"}
              .uk-form-row
                %h3.uk-form-label{:for=>"fullname"} Контактное лицо
                .uk-form-controls
                  %input#fullname.uk-width-1-1.editable{:type=>"text", :required=>"", :value=>@current_user.fullname, :name=>"fullname", :readonly=>""}
              .uk-form-row
                %h3.uk-form-label Электронная почта
                .uk-form-controls{:for=>"email"}
                  %input#email.uk-width-1-1.editable{:type=>"email", :required=>"", :value=>@current_user.email, :name=>"email", :readonly=>""}
              .uk-form-row
                %h3.uk-form-label{:for=>"location"} Населенный пункт
                .uk-form-controls
                  %input#location.uk-width-1-1.editable{:type=>"text", :required=>"", :value=>Placement.get(@current_user.placement_id).location + (Placement.get(@current_user.placement_id).area.length > 1 ? ", " + Placement.get(@current_user.placement_id).area : "") + (Placement.get(@current_user.placement_id).region.length > 1 ? ", " + Placement.get(@current_user.placement_id).region : ""), :name=>"location", :readonly=>""}
                  %input#locationtitle{:type=>"text", :name=>"locationtitle", :hidden=>"true", :value=>Placement.get(@current_user.placement_id).location}
                  %input#area{:type=>"text", :name=>"area", :hidden=>"true", :value=>Placement.get(@current_user.placement_id).area}
                  %input#region{:type=>"text", :name=>"region", :hidden=>"true", :value=>Placement.get(@current_user.placement_id).region}
              .uk-form-row
                %h3.uk-form-label{:for=>"site"} На сайте с
                .uk-form-controls
                  %input#site.uk-form-width-large{:type=>"text", :required=>"", :value=>@current_user.created_at.strftime("%d.%m.%Y"), :readonly=>""}
              .uk-form-row
                %h3.uk-form-label Пароль
                .uk-form-controls
                  #pass{:style=>"margin-top: 5px;"}
                    %a{:href=>"#changepass", "data-uk-modal" => "{bgclose:false}"}Изменить пароль
              %br
              / %a#editprofile.uk-button.uk-button-primary.uk-align-center.uk-text-center{:style => "cursor: pointer;"} Изменить профиль
              .uk-grid
                .uk-width-1-2.uk-container-center.uk-text-center
                  %button#apply.uk-button.uk-button-success{:type=>"submit", :style=>"display: none;"} Сохранить изменения
                .uk-width-1-2.uk-container-center.uk-text-center
                  %button#cancel.uk-button{:type=>"reset", :style=>"display: none;"} Отменить изменения
            %button#editprofile.uk-button
              %i.uk-icon-edit-sign
              Изменить
          %li
            - if @myactiveorders.size < 1
              %h3.uk-display-inline Нет активных заявок
            - else
              %h3.uk-display-inline Активные заявки
            %a#addorder{:href=>"/neworder"}
              %button.uk-button
                %i.uk-icon-plus-sign-alt
                Новая
            .uk-width-1-1
              %table.uk-table
                %thead
                  %tr
                    %th.uk-width-3-10
                      Заголовок
                    %th.uk-width-3-10
                      Описание
                    %th.uk-width-1-10
                      Окончание
                    %th.uk-width-2-10
                      /Предложения / Вопросы
                    %th.uk-width-1-10
                      Закрыть
                %tbody
                  - @myactiveorders.each do |o|
                    %tr
                      %td
                        %a{:href=>"/order/"+o.id.to_s} #{o.title}
                      %td
                        #{o.subject}
                      %td
                        -if o.td.strftime("%d.%m.%Y") != "01.01.3000"
                          .uk-text-center #{o.td.strftime("%d.%m.%Y")}
                        - else
                          .uk-text-center -
                      %td
                        %i.uk-icon-eye{"data-uk-tooltip" => "", :title=>"Просмотры"}
                        #{o.views}
                        %i.uk-icon-comments-o{"data-uk-tooltip" => "", :title=>"Предложения"}
                        #{Offer.count(:order_id => o.id)}
                        %i.uk-icon-question-circle{"data-uk-tooltip" => "", :title=>"Вопросы"}
                        #{Message.count(:order_id => o.id, :sender.not => current_user)}
                      %td.uk-text-center
                        %form{:action => "/closeorder/"+o.id.to_s, :method => "post"}
                          %button{:type => "submit"}
                            %i.uk-icon-minus


              / .uk-grid
              /   .uk-width-1-3
              /     %p.uk-text-small Заголовок
              /   .uk-width-2-3
              /     .uk-grid
              /       .uk-width-2-5
              /         %p.uk-text-small Описание
              /       .uk-width-1-5
              /         %p.uk-text-center.uk-text-small Окончание
              /       .uk-width-1-5
              /         %p.uk-text-center.uk-text-small Предложения / Вопросы
              /       .uk-width-1-5
              /         %p.uk-text-center.uk-text-small Закрыть
              /   - @myactiveorders.each do |o|
              /     .uk-width-1-3 
              /       %p.uk-text-truncate
              /         %a{:href=>"/order/"+o.id.to_s} #{o.title}
              /     .uk-width-2-3
              /       .uk-grid
              /         .uk-width-2-5
              /           %p.uk-text-truncate #{o.subject}
              /         .uk-width-1-5
              /           -if o.td.strftime("%d.%m.%Y") != "01.01.3000"
              /             %p.uk-text-center #{o.td.strftime("%d.%m.%Y")}
              /           - else
              /             %p.uk-text-center -
              /         .uk-width-1-5
              /           %p.uk-text-center #{Offer.count(:order_id => o.id)} / #{Message.count(:order_id => o.id, :sender.not => current_user)}
              /         .uk-width-1-5.uk-text-center
              /           %form{:action => "/closeorder/"+o.id.to_s, :method => "post"}
              /             %button{:type => "submit"}
              /               %i.uk-icon-minus
            %hr
            - if @myclosedorders.size < 1
              %h3 Нет закрытых заявок
            - else
              %h3 Закрытые заявки
              .uk-grid
                .uk-width-1-3
                  %p.uk-text-small Заголовок
                .uk-width-2-3
                  .uk-grid
                    .uk-width-2-4
                      %p.uk-text-small Описание
                    .uk-width-1-4
                      %p.uk-text-center.uk-text-small Окончание
                    .uk-width-1-4
                      %p.uk-text-small Удалить
                - @myclosedorders.each do |o|
                  .uk-width-1-3
                    %p.uk-text-truncate
                      %a{:href=>"/order/"+o.id.to_s} #{o.title}
                  .uk-width-2-3
                    .uk-grid
                      .uk-width-2-4
                        %p.uk-text-truncate #{o.subject}
                      .uk-width-1-4
                        %p.uk-text-center #{o.td.strftime("%d.%m.%Y")}
                      .uk-width-1-4
                        %form{:action => "/delorder/"+o.id.to_s, :method => "post"}
                          %button{:type => "submit"}
                            %i.uk-icon-remove
            %br
            / %a.uk-button.uk-button-primary.uk-align-center.uk-text-center{:href=>"/neworder"} Создать заявку
    .uk-width-1-3
      .uk-panel.uk-panel-box
        %h2 Yandex Direct AD

#changepass.uk-modal
  .uk-modal-dialog.uk-modal-dialog-slide
    %a.uk-modal-close.uk-close
    %h1.uk-text-center Изменение пароля
    %hr
    %form.uk-form.uk-form-horizontal{:action => "/changepassword", :method => "post"}
      .uk-form-row
        %label.uk-form-label{:for=>"oldpass"} Текущий пароль
        %input#oldpass{:type=>"password", :required=>"", :name=>"oldpass"}
      .uk-form-row
        %label.uk-form-label{:for=>"newpass1"} Новый пароль
        %input#newpass1{:type=>"password", :required=>"", :name=>"newpass1"}
      .uk-form-row
        %label.uk-form-label{:for=>"newpass2"} Повторите новый пароль
        %input#newpass2{:type=>"password", :required=>"", :name=>"newpass2"}
      %br
      %button#submit.uk-button.uk-button-primary.uk-align-center{:type=>"submit"} Изменить пароль

:javascript
  var old_fullname;
  var old_email;
  var old_location
  $(function() {
    $('#editprofile').click(function() {
      $('.editable').removeAttr("readonly");
      $('.editable').addClass("uk-form-success");
      $('#editprofile').css("display", "none");
      $('#apply').css("display", "inline-block");
      $('#cancel').css("display", "inline-block");
      $('#avatarfrm').removeAttr("hidden");
      $('#avatarlbl').css("display", "none");
    });

    $('#cancel').click(function() {
      $('.editable').attr("readonly","");
      $('.editable').removeClass("uk-form-success");
      $('#editprofile').css("display", "inline-block");
      $('#apply').css("display", "none");
      $('#cancel').css("display", "none");
      $('#avatarfrm').attr("hidden", "true");
      $('#avatarlbl').css("display", "inline-block");
    });

    $('#location').autocomplete({
      source: function( request, response ) {
        $.ajax({
          url: "http://api.vk.com/method/database.getCities?v=5&country_id=1&count=5",
          dataType: "jsonp",
          data: {
            q: request.term
          },
          success: function( data ) {
            response( $.map( data.response.items, function( item ) {
              return {
                label: item.title + (item.area ? ", " + item.area : "") + (item.region ? ", " + item.region : ""),
                value: item.title,
                area: item.area ? item.area : "",
                region: item.region ? item.region : ""
              }
            }))
          }
        });
      },
      minLength: 2,
      select: function (event, ui) {
        $('#locationtitle').val(ui.item.value);
        $('#area').val(ui.item.area);
        $('#region').val(ui.item.region);
        regionselected = true;
      }
    });

    $('#addorder').click(function() {
      window.location.href = "/neworder";
    });
  });